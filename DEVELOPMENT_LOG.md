# データサルベージプログラム 開発ログ

## 初期セットアップ

### プロジェクト構造
- プロジェクトの基本的なディレクトリ構造を作成
  - `src/`: ソースコードディレクトリ
    - `main.py`: メインエントリーポイント
    - `disk_operations/`: ディスク操作モジュール
    - `file_operations/`: ファイル操作モジュール
    - `gui/`: GUIモジュール
    - `utils/`: ユーティリティモジュール
  - `tests/`: テストディレクトリ

### 実装モジュール
1. メインモジュール (`main.py`)
   - 初期化処理
   - エラーハンドリングの基本実装

2. ディスク操作モジュール (`disk_manager.py`)
   - ディスク検出、マウント、アンマウント
   - ファイルシステムチェック
   - ディスク情報取得

3. ファイル操作モジュール (`file_handler.py`)
   - ファイル一覧取得
   - ファイルコピー
   - ファイル属性取得
   - 破損ファイルハンドリング

4. GUIモジュール (`main_window.py`)
   - レイアウト作成
   - プログレスバー更新
   - エラーメッセージ表示
   - ファイル一覧更新

5. ロガーモジュール (`logger.py`)
   - ログ記録
   - ログ保存
   - 操作履歴エクスポート

### テスト
- 全モジュールに対して基本的なテストケースを実装
- pytestを使用
- カバレッジ: 全モジュールでテストをパス

## エラーハンドリングの強化

### 方針
- `ERROR_REFERENCE.md` に定義されたエラーコードとその説明に基づいて、各モジュールのエラーハンドリングを改善する
- エラーコードの定義と適切な箇所でのエラーコードの設定
- エラーメッセージの改善（エラーコードや詳細情報の追加）
- ログ出力の強化（エラー発生時の状況をより詳細に記録）
- 重大なエラー発生時のプログラムの適切な終了処理

### 進捗
- [2023-04-24] エラーハンドリング強化の方針を決定
- [2023-04-24] `ERROR_REFERENCE.md` にエラーコードとその説明を定義
- [2023-04-24] 各モジュールのエラーハンドリングを強化
  - エラーコードの設定
  - エラーメッセージの改善
  - ログ出力の強化
- [2023-04-24] `DiskManager` クラスに `logger` 属性を追加
- [2023-04-24] テストを実行し、エラーハンドリングが適切に機能することを確認
- [2023-04-24] エラーハンドリングの強化完了

## 2024-02-28
### FileHandlerクラスのエラーハンドリング強化
- エラーコードの定義（FILE_001からFILE_006）を追加
- 各メソッドにエラーハンドリングとログ出力を実装
  - list_files: ファイル一覧取得エラー（FILE_001）
  - copy_files: ファイルコピーエラー（FILE_002）
  - verify_copy: コピー検証エラー（FILE_003）
  - get_file_attributes: 属性取得エラー（FILE_004）
  - check_file_accessibility: アクセス確認エラー（FILE_005）
  - handle_corrupted_files: 破損ファイル処理エラー（FILE_006）
- テストケースの修正と追加
  - test_copy_filesのアサーションを正しいログメッセージに対応するよう修正
- すべてのテストが正常にパス（30/30）

### FileHandlerクラスの実装完了
- 各メソッドの実装を完了
  - list_files: ファイル一覧の再帰的取得を実装
  - copy_files: ファイルコピー処理を実装
  - verify_copy: コピー検証（サイズとハッシュ値の比較）を実装
  - get_file_attributes: ファイル属性の取得を実装
  - check_file_accessibility: ファイルアクセス可能性の確認を実装
  - handle_corrupted_files: 破損ファイルの検出とハンドリングを実装
- 各メソッドのテストを実行し、すべてのテストがパス
- エラーハンドリングとログ出力を強化

## 2024-02-29
### テストの強化
1. main.pyのテストカバレッジ向上
   - アプリケーション初期化のテストを追加
   - イベントループのテストを追加
   - エラーケースのテストを追加
   - カバレッジが35%から80%以上に改善

2. file_handler.pyのエラーケースのテスト追加
   - 各メソッドのエラーケースをカバー
   - エッジケースのテストを追加
   - 複数ファイルの同時処理テストを追加

3. 環境依存テストの分離
   - Linux環境専用のテストを`@pytest.mark.linux_only`で分離
   - Windows環境専用のテストを`@pytest.mark.windows_only`で分離
   - テスト実行環境に応じた自動スキップ機能を実装

4. GitHub Actionsの設定
   - Ubuntu環境でのテスト自動実行を設定
   - テストカバレッジレポートの自動生成
   - Codecovへのレポートアップロード

### 次のステップ
1. GUIの実装（main_window.py）
   - メインウィンドウのレイアウト作成
   - ファイル一覧表示機能
   - 進捗表示機能
   - エラー表示機能
2. メインプログラムの実装（main.py）
   - 初期化処理
   - モジュール間の連携
   - エラーハンドリング

## 今後の課題
- 実際のディスク操作の実装
- ファイルコピーの詳細な検証
- エラーハンドリングの強化
- sudo権限取得の実装
- GUIの詳細デザイン

## 開発環境
- Python 3.11
- PySimpleGUI
- pytest
- OS: Windows (開発環境)
- ターゲットOS: Lubuntu

## 注意点
- Linuxベースのシステムを想定
- sudo権限での動作を前提
- データ復旧時の安全性を最優先 